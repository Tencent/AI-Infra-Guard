info:
  name: langchain
  cve: CVE-2024-58340
  summary: LangChain 的 MRKLOutputParser.parse() 方法存在正则表达式拒绝服务 (ReDoS) 漏洞。
  details: |
    LangChain 版本（包括 0.3.1 及更早版本）的 MRKLOutputParser.parse() 方法（libs/langchain/langchain/agents/mrkl/output_parser.py）中存在一个正则表达式拒绝服务 (ReDoS) 漏洞。当从模型输出中提取工具动作时，此解析器应用了一个容易回溯的正则表达式。攻击者如果能够提供或影响被解析的文本（例如通过下游应用程序中的提示注入，这些应用程序将 LLM 输出直接传递给 MRKLOutputParser.parse()），则可以通过提供特制的有效载荷来触发过度的 CPU 消耗，从而导致显著的解析延迟和拒绝服务状况。
  cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
  severity: HIGH
  security_advise: |
    1. 将 LangChain 升级到高于 0.3.1 的版本。
    2. 对传递给 `MRKLOutputParser.parse()` 的数据实施输入验证和清理，以防止特制有效载荷。
    3. 如果无法立即升级，请考虑使用不受 ReDoS 漏洞影响的替代解析机制或库。
rule: version <= "0.3.1"
references:
  - https://nvd.nist.gov/vuln/detail/CVE-2024-58340
  - https://github.com/langchain-ai/langchain
  - https://huntr.com/bounties/e7ece02c-d4bb-4166-8e08-6baf4f8845bb
  - https://www.langchain.com
  - https://www.vulncheck.com/advisories/langchain-mrkloutputparser-redos