info:
  name: langchain
  cve: CVE-2025-65106
  summary: LangChain 存在通过提示模板中的属性访问进行模板注入的漏洞，允许攻击者访问 Python 对象的内部。
  details: |
    LangChain 的提示模板系统中存在模板注入漏洞，允许攻击者通过模板语法访问 Python 对象的内部。这影响接受来自 `ChatPromptTemplate` 和相关类中不受信任的模板字符串的应用程序。攻击者可以遍历对象属性和字典查找（例如，`__globals__`）以提取敏感数据，如环境变量。此漏洞需要控制模板字符串本身，而不仅仅是模板变量。
  cvss: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:N/VC:H/VI:L/VA:N/SC:N/SI:N/SA:N
  severity: HIGH
  security_advise: |
    1. 审计您的代码，查找任何模板字符串来自不受信任来源的位置。
    2. 更新到打补丁的 `langchain-core` 版本（>=1.0.7 或 >=0.3.80）。
    3. 审查模板使用，确保模板结构与用户数据分离。
    4. 考虑模板是否必要；直接的消息对象通常就足够了。
    5. 仅将 Jinja2 模板用于受信任的来源。
rule: version < "1.0.7" || version < "0.3.80"
references:
  - https://github.com/langchain-ai/langchain/security/advisories/GHSA-6qv9-48xg-fc7f
  - https://nvd.nist.gov/vuln/detail/CVE-2025-65106
  - https://github.com/langchain-ai/langchain/commit/c4b6ba254e1a49ed91f2e268e6484011c540542a
  - https://github.com/langchain-ai/langchain/commit/fa7789d6c21222b85211755d822ef698d3b34e00
  - https://github.com/langchain-ai/langchain