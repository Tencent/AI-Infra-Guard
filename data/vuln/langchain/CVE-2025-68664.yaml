info:
  name: langchain
  cve: CVE-2025-68664
  summary: LangChain 序列化注入漏洞允许在 dumps/loads API 中提取秘密。
  details: |
    LangChain 的 `dumps()` 和 `dumpd()` 函数中存在序列化注入漏洞，原因是未能正确转义带有 `'lc'` 键的字典。这允许攻击者注入恶意的 LangChain 对象结构，导致秘密提取（例如，环境变量）以及使用攻击者控制的参数进行类实例化，从而可能触发副作用，如网络调用或文件操作。
  cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:L/A:N
  severity: CRITICAL
  security_advise: |
    1. 将 `langchain-core` 升级到版本 `1.2.5` 或更高。
    2. 如果使用较旧的主要版本，请将 `langchain-core` 升级到版本 `0.3.81` 或更高。
    3. 反序列化自定义类时，使用 `load()` 或 `loads()` 中的 `allowed_objects` 参数明确指定允许的对象。
    4. 如果需要 Jinja2 模板，请将 `init_validator=None` 传递给 `load()` 或 `loads()`，但仅限于序列化数据受信任的情况。
    5. 如果需要从环境变量加载秘密，请在 `load()` 或 `loads()` 中明确设置 `secrets_from_env=True`。
rule: (version > "0" && version < "0.3.81") || (version >= "1.0.0" && version < "1.2.5")
references:
  - https://github.com/langchain-ai/langchain/security/advisories/GHSA-c67j-w6g6-q2cm
  - https://nvd.nist.gov/vuln/detail/CVE-2025-68664
  - https://github.com/langchain-ai/langchain/pull/34455
  - https://github.com/langchain-ai/langchain/pull/34458
  - https://github.com/langchain-ai/langchain/commit/5ec0fa69de31bbe3d76e4cf9cd65a6accb8466c8
  - https://github.com/langchain-ai/langchain/commit/d9ec4c5cc78960abd37da79b0250f5642e6f0ce6
  - https://github.com/langchain-ai/langchain
  - https://github.com/langchain-ai/langchain/releases/tag/langchain-core%3D%3D0.3.81
  - https://github.com/langchain-ai/langchain/releases/tag/langchain-core%3D%3D1.2.5