info:
  name: pyload-ng
  cve: CVE-2025-54140
  summary: pyLoad NG 中经认证的路径遍历漏洞允许任意文件写入
  details: |
    在 pyLoad NG 的 `/json/upload` 接口中存在一个经认证的路径遍历漏洞。攻击者通过操控上传文件的文件名（例如使用 `../../../../etc/passwd`），可以在系统上以 pyLoad 进程权限将文件写入到任意位置。
    漏洞代码未对 `filename` 参数进行清理：
    ```python
    @json_blueprint.route("/upload", methods=["POST"])
    def upload():
        dir_path = api.get_config_value("general", "storage_folder")
        for file in request.files.getlist("file"):
            file_path = os.path.join(dir_path, "tmp_" + file.filename)  
            file.save(file_path) 
    ```
    根据文件被写入的位置和处理方式，此问题可能导致远程代码执行（RCE）、权限提升、持久化机制植入以及整个系统的完全控制。
    概念验证步骤：
    1. 认证并获取会话 Cookie
    2. 上传一个包含目录遍历序列的恶意构造文件名的文件
    3. 服务器将该文件写入预期目录之外的位置，可能通过计划任务或 Web 可访问路径实现远程代码执行。
cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
severity: HIGH
security_advise: |
  1. 升级至版本 `pyload-ng>=0.5.0b3.dev90` 或更高版本，其中已修复此漏洞。
  2. 对所有用户提供的文件名在保存前实施输入验证与清理操作。
  3. 限制文件上传目录，并确保这些目录不可执行。
  4. 审查现有安装环境，在如 `/etc/cron.d/` 等系统路径中查找是否存在异常文件。
rule: version >= "0.5.0b3.dev89" && version < "0.5.0b3.dev90"
references:
  - https://github.com/pyload/pyload/security/advisories/GHSA-xqpg-92fq-grfg
  - https://nvd.nist.gov/vuln/detail/CVE-2025-54140
  - https://github.com/pyload/pyload/commit/fc4b136e9c4e7dcbb8e467ae802cb2c3f70a71b0
  - https://github.com/pyload/pyload
  - https://github.com/pyload/pyload/blob/df094db67ec6e25294a9ac0ddb4375fd7fb9ba00/src/pyload/webui/app/blueprints/json_blueprint.py#L109