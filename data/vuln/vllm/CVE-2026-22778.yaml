info:
  name: vllm
  cve: CVE-2026-22778
  summary: vLLM 中的一系列漏洞，包括信息泄露和堆溢出，在处理恶意视频 URL 时可能导致远程代码执行 (RCE)。
  details: |
    vLLM 中的漏洞链通过两个主要缺陷实现远程代码执行 (RCE)：
    1. **信息泄露 (ASLR 绕过)：** 向 vLLM 的多模态端点发送无效图像会导致 PIL 抛出错误，该错误会返回给客户端并泄露堆地址。这大大降低了 ASLR 的有效性。
    2. **堆溢出：** vLLM 使用 OpenCV (cv2) 解码视频，其中捆绑了 FFmpeg 5.1.x。FFmpeg 内的 JPEG2000 解码器包含一个堆溢出漏洞。JPEG2000 帧中的恶意 `cdef` 框可以将 Y（亮度）通道重新映射到较小的 U（色度）缓冲区中，从而导致堆溢出。此溢出可用于覆盖 `AVBuffer` 结构的 `free()` 函数指针为 `system()`，从而在缓冲区释放时允许任意命令执行。
    当提供 `video_url` 时，此漏洞可通过 `/v1/chat/completions` 和 `/v1/invocations` 端点利用。未提供视频模型的部署不受影响。
  cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  severity: CRITICAL
  security_advise: |
    1. 将 vLLM 升级到版本 `0.14.1` 或更高版本。
    2. 如果无法立即升级，请确保只处理受信任的视频源。
    3. 审查并实施 vLLM 实例的身份验证机制，尽管在某些配置中此漏洞可以绕过预认证。
rule: version >= "0.8.3" && version < "0.14.1"
references:
  - https://github.com/vllm-project/vllm/security/advisories/GHSA-4r2x-xpjr-7cvv
  - https://nvd.nist.gov/vuln/detail/CVE-2026-22778
  - https://github.com/vllm-project/vllm/pull/31987
  - https://github.com/vllm-project/vllm/pull/32319
  - https://github.com/vllm-project/vllm/pull/32668
  - https://github.com/vllm-project/vllm
  - https://github.com/vllm-project/vllm/releases/tag/v0.14.1